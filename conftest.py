#@project:  grpc_auto_project
#@author: heyeping
#@file: conftest.py.py
#@ide: PyCharm
#@time: 2021/4/14 5:19 PM

import pytest
import grpc


#@pytest.fixture(scope="class")
def init_channel():
    pem = '''
    -----BEGIN CERTIFICATE-----
MIIHSDCCBjCgAwIBAgIQNdS/rt77ogQAAAAAUPfrsTANBgkqhkiG9w0BAQsFADCB
ujELMAkGA1UEBhMCVVMxFjAUBgNVBAoTDUVudHJ1c3QsIEluYy4xKDAmBgNVBAsT
H1NlZSB3d3cuZW50cnVzdC5uZXQvbGVnYWwtdGVybXMxOTA3BgNVBAsTMChjKSAy
MDEyIEVudHJ1c3QsIEluYy4gLSBmb3IgYXV0aG9yaXplZCB1c2Ugb25seTEuMCwG
A1UEAxMlRW50cnVzdCBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eSAtIEwxSzAeFw0x
OTA5MzAxMTAzNDFaFw0yMTA5MzAxMTMzNDBaMHYxCzAJBgNVBAYTAkNOMRIwEAYD
VQQIEwlHdWFuZ2RvbmcxETAPBgNVBAcTCFNoZW56aGVuMSgwJgYDVQQKEx9BeWxh
IE5ldHdvcmtzIFNoZW56aGVuIENvLiwgTHRkMRYwFAYDVQQDDA0qLmF5bGEuY29t
LmNuMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqmWWdmL+34+sbrcZ
XFCE3fkBP4bg63BeWoGdGZc9PZuL4hXIhMNhHhP2W1A6i7akUI1kKHkF8peIYnWl
EJrJQw8gPu9xDzi+Bd3h2lQ13+jqh60KGUxV3UxM8+RyQpXne9o66BbXDtFN+2D/
HfdJrcNh8ojYRvZq1HG23CTPtZILzfTucxsk8rER6zqtHLk+DUwKQnr9CF6ExSVJ
INV2c/AGUmubfcfcpct/M7Xlj1DEr6N92g9TsWriIXqyZwJKizqEbJVTzqZKXvpS
Y26yZnsKSJabP7m/9sqkTAbZdfxVHvtBY/5s8vXKa/133mbmA1HUFuaxMjXo5zSZ
y9Rv1QIDAQABo4IDizCCA4cwJQYDVR0RBB4wHIINKi5heWxhLmNvbS5jboILYXls
YS5jb20uY24wggH2BgorBgEEAdZ5AgQCBIIB5gSCAeIB4AB1AId1v+dZfPiMQ5lf
vfNu/1aNR1Y2/0q1YMG06v9eoIMPAAABbYHyl1gAAAQDAEYwRAIgMXLKYbJ1iEWm
PAm+T2VVAPTMWznCGPsNmE3v12+HXOECIGgFT389jQWFY8E8INx2NDbFuqicKECn
N7P0jKms3DMEAHYAVYHUwhaQNgFK6gubVzxT8MDkOHhwJQgXL6OqHQcT0wwAAAFt
gfKXeQAABAMARzBFAiEAmpd6cmuX2JuGJrZbZvhyMJblzXvCRxpjaEkwn8wtFL4C
IGc/Acd4PDDD1ofNbcVw626TCXUvyWzD6zdXU+F9K11UAHcARJRlLrDuzq/EQAfY
qP4owNrmgr7YyzG1P9MzlrW2gagAAAFtgfKXYgAABAMASDBGAiEAnjkB0jB6CBTB
NWCojYT/Y8JOcsvXE6PFt9VV5s5aROwCIQC1MbQn+WhPf0osJyrXFTcwM+kcPq1r
PMtaoj2myBaRrQB2AO5Lvbd1zmC64UJpH6vhnmajD35fsHLYgwDEe4l6qP3LAAAB
bYHyl0AAAAQDAEcwRQIgUGmgUJ27iWAqKQ5UzICbYbHYegzCnkSDx7H5CuTmSA0C
IQCy+IPRa5M/LvUVtqPeSsTy7vV53cALSxsVY+1xKSL+4DAOBgNVHQ8BAf8EBAMC
BaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMDMGA1UdHwQsMCowKKAm
oCSGImh0dHA6Ly9jcmwuZW50cnVzdC5uZXQvbGV2ZWwxay5jcmwwSwYDVR0gBEQw
QjA2BgpghkgBhvpsCgEFMCgwJgYIKwYBBQUHAgEWGmh0dHA6Ly93d3cuZW50cnVz
dC5uZXQvcnBhMAgGBmeBDAECAjBoBggrBgEFBQcBAQRcMFowIwYIKwYBBQUHMAGG
F2h0dHA6Ly9vY3NwLmVudHJ1c3QubmV0MDMGCCsGAQUFBzAChidodHRwOi8vYWlh
LmVudHJ1c3QubmV0L2wxay1jaGFpbjI1Ni5jZXIwHwYDVR0jBBgwFoAUgqJwdN28
Uz/Pe9T3zX+nYMYKTL8wHQYDVR0OBBYEFHfATyukCE0o1ydv+CgT8Iz2jWswMAkG
A1UdEwQCMAAwDQYJKoZIhvcNAQELBQADggEBACO0FU8b6OkUNZbQ+Mb78qGIIBnd
qIC68c6XWYK5yyulyvAC2B7kOADFxDh8GjS0sQ9q3Mt5zefJyXnh7q7+SBq5eHlh
FyTICzCV6MpAz2gc9ZiQXIkYVT221ohlUimkj4kFhLgpgW24ANE1Ql5gFZZHImY1
vR/zhZPZ8VGLx8tzOn11BCeMlbxiElqnyZnAUMpHBwjbG28T+X8y3L0hlHp8bvPj
rOQFoqp2DUmlG0fOqu2NNKX7px1ZfwdKj4JBhivMVIR/aOEIS4402ERbTtI9gisg
b6FKqfhbwdnfHKCqUosCsNyz7VcKxtVoyj8lea3rIeF/iTNliKDLHWR8aqY=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIFDjCCA/agAwIBAgIMDulMwwAAAABR03eFMA0GCSqGSIb3DQEBCwUAMIG+MQsw
CQYDVQQGEwJVUzEWMBQGA1UEChMNRW50cnVzdCwgSW5jLjEoMCYGA1UECxMfU2Vl
IHd3dy5lbnRydXN0Lm5ldC9sZWdhbC10ZXJtczE5MDcGA1UECxMwKGMpIDIwMDkg
RW50cnVzdCwgSW5jLiAtIGZvciBhdXRob3JpemVkIHVzZSBvbmx5MTIwMAYDVQQD
EylFbnRydXN0IFJvb3QgQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkgLSBHMjAeFw0x
NTEwMDUxOTEzNTZaFw0zMDEyMDUxOTQzNTZaMIG6MQswCQYDVQQGEwJVUzEWMBQG
A1UEChMNRW50cnVzdCwgSW5jLjEoMCYGA1UECxMfU2VlIHd3dy5lbnRydXN0Lm5l
dC9sZWdhbC10ZXJtczE5MDcGA1UECxMwKGMpIDIwMTIgRW50cnVzdCwgSW5jLiAt
IGZvciBhdXRob3JpemVkIHVzZSBvbmx5MS4wLAYDVQQDEyVFbnRydXN0IENlcnRp
ZmljYXRpb24gQXV0aG9yaXR5IC0gTDFLMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A
MIIBCgKCAQEA2j+W0E25L0Tn2zlem1DuXKVh2kFnUwmqAJqOV38pa9vH4SEkqjrQ
jUcj0u1yFvCRIdJdt7hLqIOPt5EyaM/OJZMssn2XyP7BtBe6CZ4DkJN7fEmDImiK
m95HwzGYei59QAvS7z7Tsoyqj0ip/wDoKVgG97aTWpRzJiatWA7lQrjV6nN5ZGhT
JbiEz5R6rgZFDKNrTdDGvuoYpDbwkrK6HIiPOlJ/915tgxyd8B/lw9bdpXiSPbBt
LOrJz5RBGXFEaLpHPATpXbo+8DX3Fbae8i4VHj9HyMg4p3NFXU2wO7GOFyk36t0F
ASK7lDYqjVs1/lMZLwhGwSqzGmIdTivZGwIDAQABo4IBDDCCAQgwDgYDVR0PAQH/
BAQDAgEGMBIGA1UdEwEB/wQIMAYBAf8CAQAwMwYIKwYBBQUHAQEEJzAlMCMGCCsG
AQUFBzABhhdodHRwOi8vb2NzcC5lbnRydXN0Lm5ldDAwBgNVHR8EKTAnMCWgI6Ah
hh9odHRwOi8vY3JsLmVudHJ1c3QubmV0L2cyY2EuY3JsMDsGA1UdIAQ0MDIwMAYE
VR0gADAoMCYGCCsGAQUFBwIBFhpodHRwOi8vd3d3LmVudHJ1c3QubmV0L3JwYTAd
BgNVHQ4EFgQUgqJwdN28Uz/Pe9T3zX+nYMYKTL8wHwYDVR0jBBgwFoAUanImetAe
733nO2lR1GyNn5ASZqswDQYJKoZIhvcNAQELBQADggEBADnVjpiDYcgsY9NwHRkw
y/YJrMxp1cncN0HyMg/vdMNY9ngnCTQIlZIv19+4o/0OgemknNM/TWgrFTEKFcxS
BJPok1DD2bHi4Wi3Ogl08TRYCj93mEC45mj/XeTIRsXsgdfJghhcg85x2Ly/rJkC
k9uUmITSnKa1/ly78EqvIazCP0kkZ9Yujs+szGQVGHLlbHfTUqi53Y2sAEo1GdRv
c6N172tkw+CNgxKhiucOhk3YtCAbvmqljEtoZuMrx1gL+1YQ1JH7HdMxWBCMRON1
exCdtTix9qrKgWRs6PLigVWXUX/hwidQosk8WwBD9lu51aX8/wdQQGcHsFXwt35u
Lcw=
-----END CERTIFICATE-----

    '''

    # credentials=grpc.ssl_channel_credentials()
    creds = grpc.ssl_channel_credentials(bytes(pem, encoding="utf-8"))
    channel = grpc.secure_channel(target="referenceapp-test.ayla.com.cn:9098", credentials=creds)
    # channel=grpc.insecure_channel("106.15.231.103:9098")
    return channel